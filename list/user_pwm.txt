; generated by Component: ARM Compiler 5.06 update 4 (build 422) Tool: ArmCC [4d3604]
; commandline ArmCC [--list --debug -c --asm --interleave -o.\output\user_pwm.o --asm_dir=.\list\ --list_dir=.\list\ --depend=.\output\user_pwm.d --cpu=Cortex-M3 --apcs=interwork -O0 --diag_suppress=9931 -I.\cstartup -I.\drivers\uart -I.\app\cfg -I.\iap -I.\drivers -I.\usb -I.\drivers\adc -I.\drivers\gpio -I.\drivers -I.\RTE\_lpc17xx_can_loader_debug -IC:\Keil_v5\ARM\PACK\Keil\LPC1700_DFP\2.3.0\Device\Include -IC:\Keil_v5\ARM\CMSIS\Include -D__UVISION_VERSION=523 -DLPC175x_6x -D__DEBUG_UART2_PRINTF__ -D__UART0__ -D__UART1__ -D__UART2__ -D__UART3__ -D__UART2_ENABLE__ -D__UART3_ENABLE__ -D__UART0_ENABLE__ -D__UART1_ENABLE__ --omf_browse=.\output\user_pwm.crf drivers\user_pwm.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  User_PWM_Init PROC
;;;21     //控制电调：PPM 50HZ 1120us~1920us
;;;22     void User_PWM_Init(void)
000000  4832              LDR      r0,|L1.204|
;;;23     {
;;;24     	LPC_SC->PCONP|=(1<<6);  //PWM1 power/clock control bit
000002  6800              LDR      r0,[r0,#0]
000004  f0400040          ORR      r0,r0,#0x40
000008  4930              LDR      r1,|L1.204|
00000a  39c4              SUBS     r1,r1,#0xc4
00000c  f8c100c4          STR      r0,[r1,#0xc4]
;;;25     	//LPC_PINCON->PINSEL4=(LPC_PINCON->PINSEL4&0xfffffccf)|0x0110;//P2.2 P2.4
;;;26     	LPC_PINCON->PINSEL3=(LPC_PINCON->PINSEL3&0xfffffcff)|0x0200;//P1.20 
000010  482f              LDR      r0,|L1.208|
000012  68c0              LDR      r0,[r0,#0xc]
000014  f4207040          BIC      r0,r0,#0x300
000018  f4407000          ORR      r0,r0,#0x200
00001c  492c              LDR      r1,|L1.208|
00001e  60c8              STR      r0,[r1,#0xc]
;;;27     	
;;;28     	LPC_SC->PCLKSEL0=(LPC_SC->PCLKSEL0&~(3<<12))|0x01<<12; //pwm clk = PCLK_peripheral
000020  482a              LDR      r0,|L1.204|
000022  30e4              ADDS     r0,r0,#0xe4
000024  6800              LDR      r0,[r0,#0]
000026  f4205040          BIC      r0,r0,#0x3000
00002a  f4405080          ORR      r0,r0,#0x1000
00002e  4927              LDR      r1,|L1.204|
000030  39c4              SUBS     r1,r1,#0xc4
000032  f8c101a8          STR      r0,[r1,#0x1a8]
;;;29     	PWM_DISABLE;
000036  4827              LDR      r0,|L1.212|
000038  6840              LDR      r0,[r0,#4]
00003a  f0200008          BIC      r0,r0,#8
00003e  4925              LDR      r1,|L1.212|
000040  6048              STR      r0,[r1,#4]
;;;30     	LPC_PWM1->PR = 0 ; //不进行分频
000042  2000              MOVS     r0,#0
000044  60c8              STR      r0,[r1,#0xc]
;;;31     	LPC_PWM1->PC = 0 ;
000046  6108              STR      r0,[r1,#0x10]
;;;32     	LPC_PWM1->CTCR =0; //选择非捕获模式	
000048  6708              STR      r0,[r1,#0x70]
;;;33     	LPC_PWM1->MCR=1<<1; //没有中断，也不停止
00004a  2002              MOVS     r0,#2
00004c  6148              STR      r0,[r1,#0x14]
;;;34     	//pwm 2 3 4 5  输出使能
;;;35     	LPC_PWM1->PCR|=((uint32_t)1<<10);
00004e  4608              MOV      r0,r1
000050  6cc0              LDR      r0,[r0,#0x4c]
000052  f4406080          ORR      r0,r0,#0x400
000056  64c8              STR      r0,[r1,#0x4c]
;;;36     	LPC_PWM1->MR0=SystemCoreClock/PWM_FREQ;
000058  481f              LDR      r0,|L1.216|
00005a  6800              LDR      r0,[r0,#0]  ; SystemCoreClock
00005c  2132              MOVS     r1,#0x32
00005e  fbb0f0f1          UDIV     r0,r0,r1
000062  491c              LDR      r1,|L1.212|
000064  6188              STR      r0,[r1,#0x18]
;;;37     	LPC_PWM1->MR2=100;  //MIN_CNT
000066  2064              MOVS     r0,#0x64
000068  6208              STR      r0,[r1,#0x20]
;;;38     	//LPC_PWM1->MR3=100;
;;;39     	//LPC_PWM1->MR4=130000;
;;;40     	//LPC_PWM1->MR5=100;
;;;41     	LPC_PWM1->TCR|=1;
00006a  4608              MOV      r0,r1
00006c  6840              LDR      r0,[r0,#4]
00006e  f0400001          ORR      r0,r0,#1
000072  6048              STR      r0,[r1,#4]
;;;42     	PWM_ENABLE;
000074  4608              MOV      r0,r1
000076  6840              LDR      r0,[r0,#4]
000078  f0400008          ORR      r0,r0,#8
00007c  6048              STR      r0,[r1,#4]
;;;43     }
00007e  4770              BX       lr
;;;44     
                          ENDP

                  Set_PWM PROC
;;;50     //********************************************//
;;;51     void Set_PWM(uint32_t persent)
000080  b570              PUSH     {r4-r6,lr}
;;;52     {
000082  4605              MOV      r5,r0
;;;53     	uint32_t freq = 0;
000084  bf00              NOP      
;;;54     	static uint32_t freq_last = 0;
;;;55     	float freq_temp = persent*((MAX_PWM - MIN_PWM)/100) + MIN_PWM;
000086  f24011a9          MOV      r1,#0x1a9
00008a  4369              MULS     r1,r5,r1
00008c  4a13              LDR      r2,|L1.220|
00008e  eb020041          ADD      r0,r2,r1,LSL #1
000092  f7fffffe          BL       __aeabi_ui2f
000096  4606              MOV      r6,r0
;;;56     	freq = (uint32_t)freq_temp;
000098  4630              MOV      r0,r6
00009a  f7fffffe          BL       __aeabi_f2uiz
00009e  4604              MOV      r4,r0
;;;57     	
;;;58     	if(freq > MAX_PWM)	
0000a0  480f              LDR      r0,|L1.224|
0000a2  4284              CMP      r4,r0
0000a4  d900              BLS      |L1.168|
;;;59     	  freq = MAX_PWM;
0000a6  4604              MOV      r4,r0
                  |L1.168|
;;;60     	if(freq < MIN_PWM)	
0000a8  480c              LDR      r0,|L1.220|
0000aa  4284              CMP      r4,r0
0000ac  d200              BCS      |L1.176|
;;;61     		freq = MIN_PWM;
0000ae  4604              MOV      r4,r0
                  |L1.176|
;;;62     	if(freq_last != freq)
0000b0  480c              LDR      r0,|L1.228|
0000b2  6800              LDR      r0,[r0,#0]  ; freq_last
0000b4  42a0              CMP      r0,r4
0000b6  d006              BEQ      |L1.198|
;;;63     	{
;;;64     	  LPC_PWM1->MR2 = freq;
0000b8  4806              LDR      r0,|L1.212|
0000ba  6204              STR      r4,[r0,#0x20]
;;;65     	  LPC_PWM1->LER |= 1<<2;
0000bc  6d00              LDR      r0,[r0,#0x50]
0000be  f0400004          ORR      r0,r0,#4
0000c2  4904              LDR      r1,|L1.212|
0000c4  6508              STR      r0,[r1,#0x50]
                  |L1.198|
;;;66     	}
;;;67     	freq_last = freq;
0000c6  4807              LDR      r0,|L1.228|
0000c8  6004              STR      r4,[r0,#0]  ; freq_last
;;;68     }
0000ca  bd70              POP      {r4-r6,pc}
;;;69     
                          ENDP

                  |L1.204|
                          DCD      0x400fc0c4
                  |L1.208|
                          DCD      0x4002c000
                  |L1.212|
                          DCD      0x40018000
                  |L1.216|
                          DCD      SystemCoreClock
                  |L1.220|
                          DCD      0x0001c138
                  |L1.224|
                          DCD      0x00030d40
                  |L1.228|
                          DCD      freq_last

                          AREA ||.data||, DATA, ALIGN=2

                  freq_last
                          DCD      0x00000000
